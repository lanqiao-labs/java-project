---
show: step
version: 1.0
enable_checker: true
---

# 图片三种展示方式和图片在线查看实现

## 实验介绍

此次实验将实现图片的三种展示方式：列表模式、网格模式、时间线模式，并实现图片的在线查看。

#### 知识点

- Vuex
- Element UI 中 Timeline 时间线组件、Radio 单选框组件的使用
- 图片预览时的放大、缩小、旋转、上一张和下一张切换

#### 开发计划

- 开发内容：
  1. 图片的三种展示方式：
      - 利用 Table 组件实现**列表模式**
      - 利用 `<ul>` 标签实现**网格模式**
      - 利用 Timeline 组件实现**时间线模式**
      - 使用 Radio 组件切换展示方式，结合 Vuex 保存图片展示方式
  2. 图片在线预览：查看、放大、缩小、旋转和切换上一张、下一张，结合 Vuex 共享图片列表数据
- 开发耗时：实验预计完成时间为 1.5~2 小时
- 开发难点：无

## 图片三种展示方式

点击左侧菜单的**图片**，右侧现在是以列表模式来展示图片的，接下来添加两种查看模式：网格模式和时间线模式。当切换网格模式时，图片将平铺显示，切换时间线模式时，图片将按照时间分组展示，类似于时间轴。同时，要实现刷新页面时保存刚才选择的图片展示方式。

### 结合 Vuex 实现图片展示方式保存

之前的实验已经结合 Vuex 实现过保存表格列显隐状态，这次同理。在 `src/views/Home/components` 下新建文件 `ShowModel.vue`，内容稍后来讲。

在 `src/views/Home/index.vue` 中引入该组件，将 fileType 传递给该组件，并对样式做些调整：

```vue
<script>
...
import ShowModel from './components/ShowModel.vue' //  1. 引入查看模式切换组件

export default {
  name: 'Home',
  components: {
    ...
    ShowModel //  2. 注册查看模式切换组件
  },
  ...
  computed: {
    ...
    // 查看模式
    showModel() {
      return this.$store.getters.showModel
    }
  },  
}
</script>
```

```vue
<div class="operation-wrapper">
    <OperationMenu
        :fileType="fileType"
        :filePath="filePath"
        :operationFileList="operationFileList"
        @getTableData="getFileData"
        @handleUploadFile="handleUploadFile"
        @handleSelectFile="setOperationFile"
        @handleMoveFile="setMoveFileDialog"
        ></OperationMenu>
   	<!-- 3. 使用查看模式切换组件 将 fileType 传递给子组件 -->
    <ShowModel :fileType="fileType"></ShowModel>
    <SelectColumn></SelectColumn>
</div>
```

```stylus
.operation-wrapper {
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;

	// 左侧菜单按钮组 样式调整
    >>> .operation-menu-wrapper {
        flex: 1;
    }
}
```

在 `ShowModel` 使用 Element UI 的[单选按钮组](https://element.eleme.cn/#/zh-CN/component/radio#an-niu-yang-shi)来实现图片展示方式的切换，编辑 `ShowModel.vue` 文件：

```vue
<template>
  <div class="change-file-model">
    <!-- v-if 只有左侧菜单选择图片时 才展示此组件 -->
    <el-radio-group v-if="fileType === 1" v-model="currentshowModel" size="mini">
      <el-radio-button :label="0"> <i class="el-icon-tickets"></i> 列表 </el-radio-button>
      <el-radio-button :label="1"> <i class="el-icon-s-grid"></i> 网格 </el-radio-button>
      <el-radio-button :label="2"> <i class="el-icon-date"></i> 时间线 </el-radio-button>
    </el-radio-group>
  </div>
</template>

<script>
export default {
  name: 'ShowModel',
  props: {
    // 文件类型
    fileType: {
      type: Number,
      required: true
    }
  },
  data() {
    return {}
  },
  computed: {
    //  查看模式 - 0 列表 | 1 网格 | 2 时间线
    currentshowModel: {
      get() {
        return this.$store.getters.showModel
      },
      set(val) {
        this.$store.commit('changeShowModel', val) //  修改查看模式
      }
    }
  }
}
</script>

<style lang="stylus" scoped>
.change-file-model {
  margin-right: 16px;
}
</style>
```

结合 Vuex 保存图片展示方式，在 `src/store/module/file.js` 中添加 `showModel`：

```javascript
export default {
  state: {
    ...
    showModel: sessionStorage.getItem('showModel') //  查看模式 - 0 列表 | 1 网格 | 2 时间线
  },
  mutations: {
    ...
    // 切换查看模式
    changeShowModel(state, data) {
      sessionStorage.setItem('showModel', data)
      state.showModel = data
    }
  }
}
```

在 `src/store/index.js` 中的 getters 中添加：

```javascript
getters: {
  ...
  // 查看模式 - 0 列表 | 1 网格 | 2 时间线
  showModel: (state) => (state.file.showModel === null ? 0 : Number(state.file.showModel))
}
```

刷新首页，可以看到无论是切换左侧菜单，还是刷新页面，图片展示方式都会被保存：

![16-1](https://doc.shiyanlou.com/courses/3472/1557563/fcb175a872211a4240419eac83177d29-0/wm)

### 网格模式

在 `src/views/Home/components` 下新建文件 `FileGrid.vue`，内容稍后添加。

在 `index.vue` 中引入此组件，并对现有的文件表格组件和此组件做显隐控制：

```vue
<template>
  <div class="home">
    <!-- 右侧内容区 -->
    <div class="home-right">
      <!-- 已有代码不再赘述 -->
      ...
      <!-- 表格组件 v-if 当左侧菜单选择图片且查看模式为"列表"时显示 或 左侧菜单选择的非图片 -->
      <FileTable
        v-if="(fileType === 1 && showModel === 0) || fileType !== 1"
        :tableData="tableData"
        :loading="loading"
        :fileType="fileType"
        @getTableData="getFileData"
        @handleSelectFile="setOperationFile"
        @handleMoveFile="setMoveFileDialog"
      ></FileTable>
      <!-- 网格模式 v-if 当左侧菜单选择图片且查看模式为"网格"时显示 -->
      <FileGrid v-if="fileType === 1 && showModel === 1" :tableData="tableData" :loading="loading"></FileGrid>
      ...
    </div>
  </div>
</template>

<script>
...
import FileGrid from './components/FileGrid.vue' //  1. 引入网格组件

export default {
  name: 'Home',
  components: {
    ...
    FileGrid //  2.	注册网格组件
  }
}
</script>
```

在 `FileGrid.vue` 中添加以下内容：

```vue
<template>
  <ul class="file-list" v-loading="loading" element-loading-text="加载中……">
    <li
      class="file-item"
      v-for="(item, index) in tableData"
      :key="index"
      :title="`${item.fileName}.${item.extendName}`"
    >
      <img class="file-img" :src="downloadImgMin(item)" />
      <div class="file-name">{{ item.fileName }}.{{ item.extendName }}</div>
    </li>
  </ul>
</template>

<script>
export default {
  name: 'FileGrid',
  props: {
    // 文件数据
    tableData: {
      type: Array,
      required: true
    },
    // 加载状态
    loading: {
      type: Boolean,
      required: true
    }
  },
  data() {
    return {}
  }
}
</script>

<style lang="stylus" scoped>
@import '~@/assets/style/mixins.styl';

.file-list {
  height: calc(100vh - 202px);
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  align-content: flex-start;
  list-style: none;
  overflow-y: auto;
  setScrollbar(8px, #EBEEF5, #909399);

  .file-item {
    margin: 16px 16px 0 0;
    border-radius: 4px;
    width: 120px;
    padding: 8px;
    cursor: pointer;
    text-align: center;

    &:hover {
      background: #F5F7FA;
    }

    .file-img {
      width: 100px;
      height: 100px;
    }

    .file-name {
      line-height: 24px;
      font-size: 12px;
      word-break: break-all;
      setEllipsis(2);
    }
  }
}
</style>
```

在 `src/assets/style/mixins.styl` 中添加以下样式：

```stylus
// 文字过长显示省略号
setEllipsis(line)
	display: -webkit-box;
	overflow: hidden;
	white-space: wrap;
	text-overflow: ellipsis;
	-webkit-box-orient: vertical;
	-webkit-line-clamp: line;
```

刷新首页，看下效果：

![16-2](https://doc.shiyanlou.com/courses/3472/1557563/e5e757fb8d03f160644802dc207a2a94-0/wm)

### 时间线模式

在 `src/views/Home/components` 下新建文件 `FileTimeLine.vue`，内容稍后添加。

在 `index.vue` 中引入此组件，并对现有的文件表格组件和此组件做显隐控制：

```vue
<template>
  <div class="home">
    <!-- 右侧内容区 -->
    <div class="home-right">
      <!-- 已有代码不再赘述 -->
      ...
      <!-- 网格模式 v-if 当左侧菜单选择图片且查看模式为"网格"时显示 -->
      <FileGrid v-if="fileType === 1 && showModel === 1" :tableData="tableData" :loading="loading"></FileGrid>
      <!-- 时间线模式 v-if 当左侧菜单选择图片且查看模式为"时间线"时显示 -->
      <FileTimeLine v-if="fileType === 1 && showModel === 2" :tableData="tableData" :loading="loading"></FileTimeLine>
      ...
    </div>
  </div>
</template>

<script>
import FileTimeLine from './components/FileTimeLine.vue' //  1. 引入时间线模式组件

export default {
  name: 'Home',
  components: {
    FileTimeLine //  2.	注册时间线模式组件
  }
}
</script>
```

在 `FileTimeLine.vue` 中使用 Element UI 的[时间线组件](https://element.eleme.cn/#/zh-CN/component/timeline#ding-yi-shi-jian-chuo)来模仿时间轴：

```vue
<template>
  <!-- 时间线模式 -->
  <div class="image-timeline-wrapper" v-loading="loading" element-loading-text="加载中……">
    <div class="radio">
      排序：
      <el-radio-group v-model="reverse">
        <el-radio :label="true">倒序</el-radio>
        <el-radio :label="false">正序</el-radio>
      </el-radio-group>
    </div>
    <el-timeline class="image-timeline-list" :reverse="reverse" v-if="imageTimelineData.length">
      <el-timeline-item
        class="image-timeline-item"
        v-for="(item, index) in imageTimelineData"
        :key="index"
        :timestamp="item.uploadDate"
        color="#409EFF"
        placement="top"
      >
        <ul class="image-list">
          <li
            class="image-item"
            v-for="(image, imageIndex) in item.imageList"
            :key="`${index}-${imageIndex}`"
            :title="`${image.fileName}.${image.extendName}`"
          >
            <img class="image" :src="downloadImgMin(image)" />
            <div class="image-name">{{ image.fileName }}.{{ image.extendName }}</div>
          </li>
        </ul>
      </el-timeline-item>
    </el-timeline>
  </div>
</template>

<script>
export default {
  name: 'FileTimeLine',
  props: {
    // 文件数据
    tableData: {
      type: Array,
      required: true
    },
    // 加载状态
    loading: {
      type: Boolean,
      required: true
    }
  },
  data() {
    return {
      reverse: true //  排序规则 - true 倒序 false 正序
    }
  },
  computed: {
    //  按年-月-日分组排序
    imageTimelineData() {
      let res = []
      //  去重，获取返回的所有日期年-月-日
      let uploadTimeSet = new Set(this.tableData.map((item) => item.uploadTime.split(' ')[0]))
      let uploadDate = [...uploadTimeSet]
      //  分组
      uploadDate.forEach((element) => {
        res.push({
          uploadDate: element,
          imageList: this.tableData.filter((item) => item.uploadTime.split(' ')[0] === element) //  过滤
        })
      })
      return res
    }
  }
}
</script>

<style lang="stylus" scoped>
@import '~@/assets/style/mixins.styl';

.image-timeline-wrapper {
  height: calc(100vh - 202px);
  overflow-y: auto;
  setScrollbar(8px);

  .image-timeline-list {
    margin-top: 8px;

    .image-timeline-item {
      .image-list {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
        align-content: flex-start;
        list-style: none;

        .image-item {
          margin: 0 16px 16px 0;
          width: 120px;
          padding: 8px;
          text-align: center;
          cursor: pointer;

          &:hover {
            background: #F5F7FA;
          }

          .image {
            width: 100px;
            height: 100px;
          }

          .image-name {
            margin-top: 8px;
            line-height: 24px;
            font-size: 12px;
            word-break: break-all;
            setEllipsis(2);
          }
        }
      }
    }
  }
}
</style>
```

刷新首页，查看效果：

![16-3](https://doc.shiyanlou.com/courses/3472/1557563/7587d102f5ad8d3eb4627158b7ad80ef-0/wm)

## 图片在线查看

图片在线查看功能，包括查看、放大、缩小、旋转和上下张切换。在点击图片时，全屏显示大图，通过鼠标滚轮或底部滑块放大缩小图片，可以切换上一张和下一张图片。考虑到列表、网格、时间线模式都需要用到此功能，因此封装为公共组件。

在 `src/components` 下新建文件 `ImgReview.vue`，内容稍后添加，用 Vuex 来共享图片列表数据，在图片点击事件中分发事件，打开图片预览。

### 图片数据共享

在 `src/store/module` 下新建文件 `imgReview.js`，添加以下内容：

```javascript
export default {
  state: {
    imgReviewVisible: false, //  图片查看组件显隐状态
    imgReviewList: [], //  图片列表
    defaultActiveIndex: 0 //  默认当前打开的图片的索引
  },
  mutations: {
    setImgReviewData(state, data) {
      if (data.imgReviewVisible) {
        state.imgReviewVisible = data.imgReviewVisible
        state.imgReviewList = data.imgReviewList
        state.defaultActiveIndex = data.activeIndex
      } else {
        state.imgReviewVisible = data.false
        state.imgReviewList = []
        state.defaultActiveIndex = 0
      }
    }
  }
}
```

在 `src/store/index.js` 中引入此模块：

```javascript
import Vue from 'vue'
import Vuex from 'vuex'
import imgReview from './module/imgReview' // 1. 引入 imgReview 模块

Vue.use(Vuex)

export default new Vuex.Store({
  modules: {
    user,
    file,
    imgReview // 2. 注册模块
  }
})
```

### 图片在线查看组件添加

在 `src/views/Home/index.vue` 中引入图片在线查看组件：

```vue
<template>
  <div class="home">
    <!-- 已有代码不再赘述 -->
    <!-- 3. 使用图片在线查看组件 -->
    <ImgReview></ImgReview>
  </div>
</template>

<script>
import ImgReview from '@/components/ImgReview' //  1. 引入图片在线查看组件

export default {
  name: 'Home',
  components: {
    ImgReview //  2. 注册图片在线查看组件
  }
}
</script>
```

在 `ImgReview.vue` 中添加以下内容：

```vue
<template>
  <div
    class="img-review-wrapper"
    v-show="imgReviewVisible"
    @click.self="closeImgReview"
    @mousewheel.prevent="rollImg()"
  >
    <!-- 顶部信息栏 & 工具栏 -->
    <div class="tip-wrapper" v-if="imgReviewVisible">
      <div class="name" :title="activeFileName + activeExtendName">{{ activeFileName }}.{{ activeExtendName }}</div>
      <div class="opera-btn-group">
        <el-input-number v-model="inputActiveIndex" :min="1" :max="imgReviewList.length" size="mini"></el-input-number>
        <span class="split-line">/</span>{{ imgReviewList.length }}
      </div>
      <div class="tool-wrapper">
        <i class="item el-icon-refresh-right" title="向右旋转" @click="rotateImg"></i>
        <a
          class="item download-link"
          target="_blank"
          :href="activeDownloadLink"
          :download="activeFileName + '.' + activeExtendName"
        >
          <i class="el-icon-download" title="保存到本地"></i>
        </a>
        <el-tooltip effect="dark" placement="bottom">
          <div slot="content">
            操作提示：<br />
            点击图片以外的区域可退出查看；<br />
            按Esc键可退出查看；<br />
            鼠标滚轮可放大缩小图片
          </div>
          <div class="item text-wrapper">
            <span class="text">操作提示</span>
            <i class="el-icon-question"></i>
          </div>
        </el-tooltip>
      </div>
    </div>
    <!-- 大图查看 -->
    <img
      class="img-large"
      ref="imgLarge"
      v-for="(item, index) in imgReviewList"
      :key="index"
      :src="item.fileUrl"
      v-show="index === activeIndex"
    />
    <!-- 左右切换图标 -->
    <i class="pre-icon el-icon-arrow-left" title="上一张" v-show="activeIndex > 0" @click.stop="activeIndex--"></i>
    <i
      class="next-icon el-icon-arrow-right"
      title="下一张"
      v-show="activeIndex < imgReviewList.length - 1"
      @click.stop="activeIndex++"
    ></i>
    <!-- 底部显示放大缩小比例 -->
    <div class="zoom-bar">
      <el-slider
        v-model="imgZoom"
        :min="imgZoomMin"
        :max="imgZoomMax"
        :format-tooltip="formatZoom"
        @input="changeZoom"
      ></el-slider>
      <div class="zoom-count">{{ imgZoom }}%</div>
    </div>
  </div>
</template>

<script>
export default {
  name: 'ImgReview',
  data() {
    return {
      rotate: 0, //  旋转角度
      activeIndex: 0, //  当前图片索引 从 0 开始
      imgZoom: 40, //  图片缩放比例
      imgZoomMin: 1, //  图片缩放最小比例
      imgZoomMax: 200 //  图片缩放最大比例
    }
  },
  computed: {
    // 图片查看组件是否显示
    imgReviewVisible() {
      return this.$store.state.imgReview.imgReviewVisible
    },
    // 图片列表
    imgReviewList() {
      return this.$store.state.imgReview.imgReviewList
    },
    // 默认显示的图片索引 从 0 开始
    defaultActiveIndex() {
      return this.$store.state.imgReview.defaultActiveIndex
    },
    // 当前显示的图片名称
    activeFileName() {
      return this.imgReviewList[this.activeIndex].fileName
    },
    // 当前显示的图片扩展名
    activeExtendName() {
      return this.imgReviewList[this.activeIndex].extendName
    },
    // 对用户而言 显示的图片索引 从 1 开始 顶部栏输入框控制此值变化
    inputActiveIndex: {
      get() {
        return this.activeIndex + 1
      },
      set(value) {
        this.activeIndex = value - 1
      }
    },
    // 当前显示的图片下载链接
    activeDownloadLink() {
      return this.imgReviewList[this.activeIndex].downloadLink
    }
  },
  watch: {
    // 监听 图片查看组件 显隐状态变化
    imgReviewVisible(val) {
      let body = document.querySelector('body')
      if (val) {
        this.activeIndex = this.defaultActiveIndex
        // 挂在body下，防止组件元素有样式transform而使position: fixed失效
        body.appendChild(this.$el)
        body.style.overflow = 'hidden'
        // 添加键盘Esc事件
        this.$nextTick(() => {
          document.addEventListener('keyup', (e) => {
            if (e.keyCode === 27) {
              this.closeImgReview()
            }
          })
        })
        this.$nextTick(() => {
          this.$refs.imgLarge[this.activeIndex].style.zoom = '40%'
        })
      } else {
        body.style.overflow = 'auto'
        document.removeEventListener('keyup', (e) => {
          if (e.keyCode === 27) {
            this.closeImgReview()
          }
        })
      }
    },
    // 监听 图片索引变化
    activeIndex(newValue) {
      this.rotate = 0
      this.$nextTick(() => {
        if (this.$refs.imgLarge[newValue].style.zoom) {
          this.imgZoom = Number(this.$refs.imgLarge[newValue].style.zoom.split('%')[0])
        } else {
          this.$refs.imgLarge[newValue].style.zoom = '40%'
          this.imgZoom = 40
        }
      })
    }
  },
  methods: {
    //  关闭图片预览
    closeImgReview() {
      this.$store.commit('setImgReviewData', { imgReviewVisible: false })
      this.rotate = 0
      this.$refs.imgLarge[this.activeIndex].style.transform = `rotate(${this.rotate}deg)`
    },
    // 格式化缩放数字 显示图片缩放比例
    formatZoom(value) {
      return value + '%'
    },
    // 图片缩放改变事件
    changeZoom(value) {
      if (this.$refs.imgLarge) {
        this.$refs.imgLarge[this.activeIndex].style.zoom = value + '%'
      }
    },
    // 缩放图片
    rollImg() {
      let zoom = parseInt(this.$refs.imgLarge[this.activeIndex].style.zoom) || 100
      zoom += event.wheelDelta / 12
      if (zoom >= this.imgZoomMin && zoom < this.imgZoomMax) {
        this.imgZoom = zoom
        this.$refs.imgLarge[this.activeIndex].style.zoom = zoom + '%'
      }
      return false
    },
    //  旋转图片
    rotateImg() {
      this.rotate += 90
      this.$refs.imgLarge[this.activeIndex].style.transform = `rotate(${this.rotate}deg)`
    }
  }
}
</script>

<style lang="stylus" scoped>
@import '~@/assets/style/mixins.styl';

.img-review-wrapper {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  overflow: auto;
  width: 100%;
  height: 100%;
  z-index: 2010;
  text-align: center;
  display: flex;
  align-items: center;
  animation: imgReviewAnimation 0.3s;
  -webkit-animation: imgReviewAnimation 0.3s; /* Safari and Chrome */
  animation-iteration-count: 0.3;
  -webkit-animation-iteration-count: 0.3;
  animation-fill-mode: forwards;
  -webkit-animation-fill-mode: forwards; /* Safari 和 Chrome */

  @keyframes imgReviewAnimation {
    0% {
      background: transparent;
    }

    100% {
      background: rgba(0, 0, 0, 0.8);
    }
  }

  @keyframes imgReviewAnimation {
    0% {
      background: transparent;
    }

    100% {
      background: rgba(0, 0, 0, 0.8);
    }
  }

  .tip-wrapper {
    box-sizing: border-box;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 2011;
    background: rgba(0, 0, 0, 0.5);
    padding: 0 48px;
    width: 100%;
    height: 48px;
    line-height: 48px;
    color: #fff;
    font-size: 16px;
    display: flex;
    justify-content: space-between;

    .name {
      flex: 1;
      padding-right: 16px;
      text-align: left;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .opera-btn-group {
      width: 100px;
      display: flex;

      >>> .el-input-number {
        width: 40px;

        .el-input-number__decrease, .el-input-number__increase {
          display: none;
        }

        .el-input__inner {
          margin-top: 14px;
          background: rgba(0, 0, 0, 0.5);
          height: 20px;
          line-height: 20px;
          padding: 0;
          font-size: 16px;
          color: #fff;
        }
      }

      .split-line {
        margin: 0 8px;
      }
    }

    .tool-wrapper {
      flex: 1;
      display: flex;
      justify-content: flex-end;

      .item {
        margin-left: 16px;
        cursor: pointer;

        &:hover {
          opacity: 0.7;
        }
      }

      .el-icon-refresh-right {
        line-height: 48px;
        font-size: 18px;
      }

      .download-link {
        color: inherit;
        font-size: 18px;
      }

      .text-wrapper {
        margin-left: 32px;

        .text {
          margin-right: 8px;
        }
      }
    }
  }

  .img-large {
    margin: 0 auto;
    transition: transform 0.5s;
    -webkit-transition: transform 0.5s; /* Safari */
  }

  .pre-icon, .next-icon {
    font-size: 60px;
    color: #fff;
    position: fixed;
    top: 50%;
    cursor: pointer;

    &:hover {
      opacity: 0.7;
    }
  }

  .pre-icon {
    left: 64px;
  }

  .next-icon {
    right: 64px;
  }

  .zoom-bar {
    position: fixed;
    right: 0;
    bottom: 20px;
    left: 0;
    margin: 0 auto;
    width: 600px;
    display: flex;

    >>> .el-slider {
      flex: 1;

      .el-slider__bar {
        background: $PrimaryText;
      }

      .el-slider__button {
        border-color: $PrimaryText;
      }
    }

    .zoom-count {
      width: 60px;
      height: 38px;
      line-height: 38px;
      text-align: right;
      color: #fff;
    }
  }
}
</style>
```

### 图片在线查看事件添加

当左侧菜单选择图片时，右侧显示图片列表，在图片点击事件中触发图片在线查看。

在 `FileGrid.vue` 中添加图片点击事件 `handleFileClick()`：

```vue
<template>
  <ul class="file-list" v-loading="loading" element-loading-text="加载中……">
    <li
      class="file-item"
      v-for="(item, index) in tableData"
      :key="index"
      :title="`${item.fileName}.${item.extendName}`"
      @click="handleFileClick(index, tableData)"
    >
      <img class="file-img" :src="downloadImgMin(item)" />
      <div class="file-name">{{ item.fileName }}.{{ item.extendName }}</div>
    </li>
  </ul>
</template>

<script>
export default {
  name: 'FileGrid',
  ...
  methods: {
    //  文件点击事件
    handleFileClick(activeIndex, imgList) {
      //  图片分类下 - 大图查看
      let data = {
        imgReviewVisible: true,
        imgReviewList: imgList.map((item) => {
          return {
            fileUrl: `/api${item.fileUrl}`,
            downloadLink: `/api/filetransfer/downloadfile?userFileId=${item.userFileId}`,
            fileName: item.fileName,
            extendName: item.extendName
          }
        }),
        activeIndex: activeIndex
      }
      this.$store.commit('setImgReviewData', data) //	触发图片在线查看
    }
  }
}
</script>
```

在 `FileTimeLine.vue` 中添加图片点击事件 `handleFileClick()`：

```vue
<li
  class="image-item"
  v-for="(image, imageIndex) in item.imageList"
  :key="`${index}-${imageIndex}`"
  :title="`${image.fileName}.${image.extendName}`"
  @click="handleFileClick(imageIndex, item.imageList)"
>
    <img class="image" :src="downloadImgMin(image)" />
    <div class="image-name">
    	{{ image.fileName }}.{{ image.extendName }}
    </div>
</li>
```

```vue
<script>
export default {
  name: 'FileTimeLine',
  ...
  methods: {
    // 文件点击事件
    handleFileClick(activeIndex, imgList) {
      let data = {
        imgReviewVisible: true,
        imgReviewList: imgList.map((item) => {
          return {
            fileUrl: `/api${item.fileUrl}`,
            downloadLink: `/api/filetransfer/downloadfile?userFileId=${item.userFileId}`,
            fileName: item.fileName,
            extendName: item.extendName
          }
        }),
        activeIndex: activeIndex
      }
      this.$store.commit('setImgReviewData', data) //	触发图片在线查看
    }
  }
}
</script>
```

在 `FileTable.vue` 中，对表格当前行是图片类型的文件，在原有的文件名点击事件 `handleFileNameClick` 中触发图片在线查看：

```javascript
// 文件名点击事件
handleFileNameClick(row) {
    //  若是目录则进入目录
    if (row.isDir) {
        this.$router.push({
            query: {
                filePath: `${row.filePath}${row.fileName}/`,
                fileType: 0
            }
        })
    } else {
        //  若当前点击项是图片
        const PIC = ['png', 'jpg', 'jpeg', 'gif', 'svg']
        if (PIC.includes(row.extendName)) {
            let data = {
                imgReviewVisible: true,
                imgReviewList: [{
                    fileUrl: `/api${row.fileUrl}`,
                	downloadLink: `/api/filetransfer/downloadfile?userFileId=${row.userFileId}`,
                    fileName: row.fileName,
                    extendName: row.extendName
                }],
                activeIndex: 0
            }
            this.$store.commit('setImgReviewData', data)	//	触发图片在线查看
        }
    }
}
```

刷新首页，看下图片在线查看效果：

![16-4](https://doc.shiyanlou.com/courses/3472/1557563/7ee4c0263622551fff760e6191a05d44-0/wm)

## 实验总结

此次实验带领大家实现了图片三种展示方式和图片在线查看，至此网盘的功能已全部讲解完毕了。优化无止境，闻道有先后，大家可以基于此项目进行二次开发和优化，例如对普通文件也添加网格模式，并在网格模式下添加鼠标右键事件，显示操作按钮组，还有勾选文件实现批量操作；对文件表格做前端排序查看功能，可以参考 Element UI 的 [Table 组件排序示例](https://element.eleme.cn/#/zh-CN/component/table#pai-xu)；实现视频在线预览、文档在线预览等更多功能。

本次实验完整代码可以通过如下命令进行下载：

```bash
wget https://labfile.oss.aliyuncs.com/courses/3472/code16.zip
```
